-- IMPORTANT: BEFORE THIS NEED TO RUN STANDARD DEVIATION LOGIC THEN RUN  OUTLIER UPDATE QUERY

--UPDATE RPT_CASE_DATA_COST_VARIANCE SET [ITEM_DESCRIPTION]= ISNULL([ITEM_DESCRIPTION],' '),
--[ITEM_ID]= ISNULL([ITEM_ID],' '),[CASE_ID]= ISNULL([CASE_ID],' '),
--[PROCEDURE_CODE]= ISNULL([PROCEDURE_CODE],' '),[PHY_ID]= ISNULL([PHY_ID],' '),
--[MFG_ITEM_ID]= ISNULL([MFG_ITEM_ID],' '),
--[SERVICE_CODE]= ISNULL([SERVICE_CODE],' ')

-- truncate should be used in place of Delete, if we are sure that, data is not required again (means rollback is not applied)
-- TRUNCATE TABLE Item_details
--1319981 (ROWS)

INSERT INTO Item_details(PROCEDURE_CODE,SERVICE_CODE,PHYSICIAN,SURGE_DESCIPTION_orig, TOTALCASEPICKQTY,[TOTAL IN ROOM QTY],[TOTAL WASTED],
TOTALRETURNED,CURRENTITEMCOST,performdatewtime,CASEID,[Group],[POU ITEM],[POU DESCRIPTION],[MHS MFGID],[PATIENT_ID],
ICD10,[ICD10 DESCRIPTION]
--,CPT1,CPT2,CPT3
,PROC_OUTLIER_Y, PROC_OUTLIER_H, PROC_OUTLIER_Q, PROC_OUTLIER_M
,ICD_OUTLIER_Y, ICD_OUTLIER_H, ICD_OUTLIER_Q, ICD_OUTLIER_M
,CPT_OUTLIER_Y, CPT_OUTLIER_H, CPT_OUTLIER_Q, CPT_OUTLIER_M)
SELECT PROCEDURE_CODE,SERVICE_CODE,PHY_ID,PHYSICIAN_NAME, ITEM_COUNT,ISSUE_QTY,WASTAGE_QTY,
RETURN_QTY,ITEM_PRICE,PERFORM_DATE,CASE_ID,ITEM_GROUP,ITEM_ID,ITEM_DESCRIPTION,MFG_ITEM_ID,[PATIENT_ID],
ICD10, ICD10_DESCRIPTION
--,CPT1,CPT2,CPT3
,PROC_OUTLIER_Y, PROC_OUTLIER_H, PROC_OUTLIER_Q, PROC_OUTLIER_M
,ICD_OUTLIER_Y, ICD_OUTLIER_H, ICD_OUTLIER_Q, ICD_OUTLIER_M
,CPT_OUTLIER_Y, CPT_OUTLIER_H, CPT_OUTLIER_Q, CPT_OUTLIER_M 
FROM RPT_CASE_DATA_COST_VARIANCE WHERE MP_CASE = 'N' AND QTY_OUTLIER = 'N'
--AND SINGLE_ICD_OUTLIER_Y = 'N' -- To include Singelton Outliers only

DELETE FROM Item_details WHERE performdatewtime IS NULL

-- NEED TO DELETE ITEMS WITH SPECIAL CHARACTERS [)>06+H435713334351Q0+$08GM0751214D20180701  ,(01) 00885403168829 , (10)60076645   (93)60076645   (17)2017/05/01(91)66 :  `` :00

delete from Item_details where [POU ITEM] in
('[)> 06+H435714201181Q0+$12GM1489614D20220701 ',
'[)> 06+H435714205881Q0+$09FM1815914D20190601 ',
'[)> 06+H435714206281Q1+$12GSM0009B14D20220801 ',
'[)> 06+H435716765811Q1+$14GM1085614D20240701 ',
'[)> 06+H435717709281Q1+$14CM1126114D20240301 ',
'[)> 06+H728717550380Q0+$13CT2895214D20230301 ',
'00',
'000')